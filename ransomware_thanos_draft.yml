name: Thanos Ransomware Early Stage Detection
id: e8b72f3a-9c21-4f85-b7a3-2f1a8c9b2e89
version: 1.0.0
description: |
  Detects early-stage Thanos ransomware behavior through its distinctive pattern of 
  file mapping operations and rapid sequence of memory view operations. This rule focuses
  on the initial reconnaissance and loading phase before encryption begins.

enabled: true

labels:
  tactic.id: TA0040
  tactic.name: Impact
  tactic.ref: https://attack.mitre.org/tactics/TA0040/
  technique.id: T1486
  technique.name: Data Encrypted for Impact
  technique.ref: https://attack.mitre.org/techniques/T1486/

tags:
  - ransomware
  - thanos
  - file-mapping
  - memory-operations

references:
  - https://attack.mitre.org/techniques/T1486/

condition: >
  sequence
    maxspan 100ms
    by ps.uuid
    |(
      kevt.name = 'MapViewFile'
      and file.view.protection = 'READONLY'
      and file.view.type = 'PAGEFILE'
    )|
    |(
      kevt.name = 'UnmapViewFile'
      and file.view.protection = 'READONLY'
      and file.view.type = 'PAGEFILE'
    )|
    |(
      kevt.name = 'CreateFile'
      and file.operation = 'OPEN'
      and file.status = 'Success'
      and file.type = 'File'
      and file.share.mask = 'READ|DELETE'
    )|
    |(
      kevt.name = 'MapViewFile'
      and file.view.protection = 'EXECUTE_READWRITE|READONLY'
      and file.view.type = 'IMAGE'
    )|

output: |
  Potential Thanos ransomware early-stage activity detected:
  Process: %ps.name (PID: %ps.pid)
  Command Line: %ps.cmdline
  Sequence of suspicious memory mapping operations detected
  Parent Process: %ps.parent.name (PPID: %ps.ppid)

severity: critical

action:
  - name: kill

min-engine-version: 2.0.0
