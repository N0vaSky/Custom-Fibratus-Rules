name: Gamma Ransomware Specific Pattern Detection
id: 90e4f21a-3c8d-4b19-a5e7-f8d3e9b87d25
version: 1.0.0
description: |
  Specific detection of Gamma ransomware that excludes normal process initialization patterns.
  Focuses on unique behavioral aspects that differentiate it from legitimate processes.
  Enhanced process and path exclusions to prevent false positives.

enabled: true

labels:
  tactic.id: TA0040
  tactic.name: Impact
  tactic.ref: https://attack.mitre.org/tactics/TA0040/
  technique.id: T1486
  technique.name: Data Encrypted for Impact
  technique.ref: https://attack.mitre.org/techniques/T1486/

tags:
  - ransomware
  - gamma
  - early-detection

references:
  - https://attack.mitre.org/techniques/T1486/

condition: >
  sequence
    maxspan 10ms
    by ps.uuid
    |(
      kevt.name = 'MapViewFile'
      and file.view.type = 'PAGEFILE'
      and file.view.size <= 16384
      and not (
        ps.name in (
          'svchost.exe',
          'services.exe',
          'lsass.exe',
          'csrss.exe',
          'smss.exe',
          'wininit.exe',
          'winlogon.exe',
          'explorer.exe',
          'System',
          'smartscreen.exe',
          'WmiPrvSE.exe',
          'brave.exe',
          'chrome.exe',
          'firefox.exe',
          'msedge.exe'
        )
      )
      and not ps.exe imatches (
        '?:\\Windows\\System32\\*',
        '?:\\Windows\\SysWOW64\\*',
        '?:\\Windows\\explorer.exe',
        '?:\\Program Files\\*',
        '?:\\Program Files (x86)\\*',
        '?:\\ProgramData\\*'
      )
      and not ps.domain in (
        'NT AUTHORITY',
        'SYSTEM',
        'LOCAL SERVICE',
        'NETWORK SERVICE'
      )
      and not ps.parent.name in (
        'services.exe',
        'wininit.exe',
        'lsass.exe',
        'winlogon.exe',
        'System',
        'svchost.exe'
      )
    )|
    |(
      kevt.name = 'CreateFile'
      and file.name imatches '?:\\Users\\*'
      and not file.name imatches (
        '?:\\Users\\*\\AppData\\*',
        '?:\\Users\\*\\Temporary Internet Files\\*'
      )
      and kevt.arg[type] = 'Directory'
      and kevt.arg[share_mask] = 'READ|WRITE|DELETE'
    )|
    |(
      kevt.name = 'EnumDirectory'
      and file.name imatches '?:\\Users\\*'
      and not file.name imatches (
        '?:\\Users\\*\\AppData\\*',
        '?:\\Users\\*\\Temporary Internet Files\\*'
      )
    )|

output: |
  Gamma ransomware specific pattern detected:
  Process: %ps.name (PID %ps.pid)
  Parent Process: %ps.parent.name (PPID %ps.ppid)
  Command Line: %ps.cmdline
  Event Sequence: Initial memory mapping followed by user directory access

severity: critical

action:
  - name: kill

min-engine-version: 2.0.0
