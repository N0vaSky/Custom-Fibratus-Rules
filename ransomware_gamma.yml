name: Gamma Ransomware Ultra-Early Detection
id: 7c52a891-d436-4ea1-9a3d-f2e9c4b87d25
version: 1.0.0
description: |
  Ultra-aggressive detection targeting Gamma ransomware's initial execution pattern.
  Focuses on the first 25ms of execution with broad pattern matching and careful
  system process exclusions. Combines successful patterns from other ransomware
  detection rules while adding Gamma-specific indicators.

enabled: true

labels:
  tactic.id: TA0040
  tactic.name: Impact
  tactic.ref: https://attack.mitre.org/tactics/TA0040/
  technique.id: T1486
  technique.name: Data Encrypted for Impact
  technique.ref: https://attack.mitre.org/techniques/T1486/

tags:
  - ransomware
  - gamma
  - early-detection
  - memory-patterns

references:
  - https://attack.mitre.org/techniques/T1486/

condition: >
  sequence
    maxspan 25ms
    by ps.uuid
    |(
      kevt.name = 'MapViewFile'
      and file.view.type = 'PAGEFILE'
      and file.view.size <= 16384
      and not (
        ps.name in (
          'svchost.exe',
          'services.exe',
          'lsass.exe', 
          'csrss.exe',
          'smss.exe',
          'wininit.exe',
          'winlogon.exe',
          'explorer.exe',
          'System',
          'MsMpEng.exe',
          'TrustedInstaller.exe',
          'RuntimeBroker.exe',
          'SearchIndexer.exe',
          'spoolsv.exe'
        )
      )
      and not ps.exe imatches (
        '?:\\Windows\\System32\\*',
        '?:\\Windows\\explorer.exe',
        '?:\\Program Files\\Windows Defender\\*',
        '?:\\Program Files*\\*'
      )
      and not (
        ps.parent.name in (
          'services.exe',
          'wininit.exe',
          'lsass.exe',
          'winlogon.exe',
          'System',
          'explorer.exe'
        )
      )
    )|
    |(
      kevt.name = 'CreateFile'
      and file.name imatches 'C:\\Windows'
      and kevt.arg[type] = 'Directory'
    )|
    |(
      kevt.name = 'MapViewFile'
      and file.view.type = 'IMAGE'
      and file.name imatches (
        'C:\\Windows\\System32\\*.dll',
        'C:\\Windows\\SysWOW64\\*.dll'
      )
    )|
    |(
      kevt.name = 'VirtualAlloc'
      and mem.type = 'PRIVATE'
      and mem.protection = 'READWRITE'
    )|
    |(
      kevt.name = 'CreateThread'
      and not (
        ps.name in (
          'svchost.exe',
          'services.exe',
          'lsass.exe',
          'csrss.exe',
          'System'
        )
      )
    )|

output: |
  Gamma ransomware early stage detected:
  Process: %ps.name (PID %ps.pid)
  Parent Process: %ps.parent.name (PPID %ps.ppid)
  Command Line: %ps.cmdline
  Initial Event: %kevt.name on %file.name

severity: critical

action:
  - name: kill

min-engine-version: 2.0.0
